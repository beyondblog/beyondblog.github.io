<!doctype html>































<html
  class="not-ready lg:text-base"
  style="--bg: #faf8f1"
  lang="zh-cn"
  dir="ltr"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>如何快速解析Solana链上DEX交易数据 - beyondのblog</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="本文总结一下链上数据的提取流程
在solana链上所有的交易都是一条条&quot;指令(instruction)“,与evm不一样的是一个transaction 可以有多条指令, 每条指令又可以有多条inner instruciton. 当然一个transaction有最大空间限制所以不是无限条具体可以看下这篇介绍https://solana.com/docs/core/transactions

Transaction 的实际结构
下面是任意获取的一笔Transaction，为了方便阅读我精简了一些内容，下面来介绍下具体每个字段的含意
{
    &#34;slot&#34;: 313260647,
    &#34;blockTime&#34;: 1736582313,
    &#34;transaction&#34;: [
        &#34;AaIhW6A2M8DD88WylJhRKc8Do6Ug6k3HuW&#43;oVZsTxnEqH7zSgBXfo80qShXG6U75zt/I2CMHhShtjmqwuGnATQKAAQAIC/IlPLKcGu5mLOINQ6rlWlO979iOhixnmws&#43;sTB/ISXRVe3ON2GuQVor9ZXyM0O/QUuYjkejwy1W/Y0wxcR76293841lAK6Ro/l9pk4BiUPA64m6P1H327XvzYkL5&#43;4JmgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwZGb&#43;UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAEedVb8jHAbu50xW7OaBUH/bGy3qP0jlECsc2iVrwTjwabiFf&#43;q4GE&#43;2h/Y0YYwDXaxDncGus7VZig8AAAAAABBt324ddloZPZy&#43;FGzut5rBy0he1fWzeROoz1hX7/AKmMlyWPTiSJ8bs9ECkUjg2DC1oTmdr/EIQEjnvY2&#43;n4WbQ/&#43;if11/ZKdMCbHylYed5LCas238ndUUsyGqezjOXo3cRwRFfjcsWHIlalRMXxolPZyNvJQQHI3W4oWrQe6b9wZhPkTTwzClMMENgiooX55CfbfRLYY7muj35FD6ca6wcEAAUCrKoBAAgGAAIABgMHAQEDAgACDAIAAAAA4fUFAAAAAAcBAgERCAYAAQAKAwcBAQUbBwACAQUKBQkFDwcLDgsNDAsLCwsLCwsLAgEAI&#43;UXy5d6460qAQAAAAdkAAEA4fUFAAAAAF4zmSQAAAAA&#43;gAABwMCAAABCQEqimLdZp9XJM4tjpUdejtF2&#43;JiEUVagWtFAa7RJzx9sAMFAwcCAgY=&#34;,
        &#34;base64&#34;
    ],
    &#34;meta&#34;: {
        &#34;err&#34;: null,
        &#34;fee&#34;: 5000,
        &#34;preBalances&#34;: [
            1000010000,
            0,
            0,
            1,
            1,
            1141440,
            788933756007,
            934087680,
            731913600,
            0,
            22502253405,
            6124801,
            2039280,
            4906415516450,
            14035088759,
            1141440
        ],
        &#34;postBalances&#34;: [
            897965720,
            2039280,
            0,
            1,
            1,
            1141440,
            788933756007,
            934087680,
            731913600,
            0,
            22502253405,
            6124801,
            2039280,
            4906515516450,
            14035088759,
            1141440
        ],
        &#34;innerInstructions&#34;: [
            {
                &#34;index&#34;: 1,
                &#34;instructions&#34;: [
                    {
                        &#34;programIdIndex&#34;: 7,
                        &#34;accounts&#34;: [
                            6
                        ],
                        &#34;data&#34;: &#34;84eT&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 3,
                        &#34;accounts&#34;: [
                            0,
                            2
                        ],
                        &#34;data&#34;: &#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 7,
                        &#34;accounts&#34;: [
                            2
                        ],
                        &#34;data&#34;: &#34;P&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 7,
                        &#34;accounts&#34;: [
                            2,
                            6
                        ],
                        &#34;data&#34;: &#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34;
                    }
                ]
            },
            {
                &#34;index&#34;: 4,
                &#34;instructions&#34;: [
                    {
                        &#34;programIdIndex&#34;: 7,
                        &#34;accounts&#34;: [
                            10
                        ],
                        &#34;data&#34;: &#34;84eT&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 3,
                        &#34;accounts&#34;: [
                            0,
                            1
                        ],
                        &#34;data&#34;: &#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 7,
                        &#34;accounts&#34;: [
                            1
                        ],
                        &#34;data&#34;: &#34;P&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 7,
                        &#34;accounts&#34;: [
                            1,
                            10
                        ],
                        &#34;data&#34;: &#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34;
                    }
                ]
            },
            {
                &#34;index&#34;: 5,
                &#34;instructions&#34;: [
                    {
                        &#34;programIdIndex&#34;: 15,
                        &#34;accounts&#34;: [
                            7,
                            11,
                            14,
                            11,
                            13,
                            12,
                            11,
                            11,
                            11,
                            11,
                            11,
                            11,
                            11,
                            11,
                            2,
                            1,
                            0
                        ],
                        &#34;data&#34;: &#34;5ucmhStLiAKrHueiRPZaPeX&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 7,
                        &#34;accounts&#34;: [
                            2,
                            13,
                            0
                        ],
                        &#34;data&#34;: &#34;3Dc8EpW7Kr3R&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 7,
                        &#34;accounts&#34;: [
                            12,
                            1,
                            14
                        ],
                        &#34;data&#34;: &#34;3x1R8aoLjRFu&#34;
                    },
                    {
                        &#34;programIdIndex&#34;: 5,
                        &#34;accounts&#34;: [
                            9
                        ],
                        &#34;data&#34;: &#34;QMqFu4fYGGeUEysFnenhAvR83g86EDDNxzUskfkWKYCBPWe1hqgD6jgKAXr6aYoEQaxoqYMTvWgPVk2AHWGHjdbNiNtoaPfZA4znu6cRUSWSeJGBkZunVEvoYenVXbq4Tge3nrNuuvC6G4k8pkFasDAwMz8bFBpKqfFBg3pHojUCfiw&#34;
                    }
                ]
            }
        ],
        &#34;preTokenBalances&#34;: [
            {
                &#34;accountIndex&#34;: 12,
                &#34;owner&#34;: &#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;,
                &#34;programId&#34;: &#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;,
                &#34;mint&#34;: &#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;,
                &#34;uiTokenAmount&#34;: {
                    &#34;amount&#34;: &#34;30190180808651&#34;,
                    &#34;decimals&#34;: 6,
                    &#34;uiAmount&#34;: 30190180.808651,
                    &#34;uiAmountString&#34;: &#34;30190180.808651&#34;
                }
            }
        ],
        &#34;postTokenBalances&#34;: [
            {
                &#34;accountIndex&#34;: 1,
                &#34;owner&#34;: &#34;HJEbYPihoGZ6wjjD5E3NHLybrcgdLLBqSHX4ZyrbqVjW&#34;,
                &#34;programId&#34;: &#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;,
                &#34;mint&#34;: &#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;,
                &#34;uiTokenAmount&#34;: {
                    &#34;amount&#34;: &#34;613769982&#34;,
                    &#34;decimals&#34;: 6,
                    &#34;uiAmount&#34;: 613.769982,
                    &#34;uiAmountString&#34;: &#34;613.769982&#34;
                }
            }
        ],
        &#34;logMessages&#34;: [],
        &#34;status&#34;: {
            &#34;Ok&#34;: null
        },
        &#34;rewards&#34;: [],
        &#34;loadedAddresses&#34;: {
            &#34;readonly&#34;: [
                &#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;,
                &#34;675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8&#34;
            ],
            &#34;writable&#34;: [
                &#34;3hsdbMFsiCh3YCsXoFjgx4TVpxECsUE9nRMgvaoyveQT&#34;,
                &#34;A67nie3cYJy58EB3uQvLGrUJaH5FVPdGmX2Wo7DLxJco&#34;,
                &#34;AcsiBWpfYJnDpg4MRUJTwCbueCRTNeLBV27v5doA9RDv&#34;
            ]
        },
        &#34;returnData&#34;: {
            &#34;programId&#34;: &#34;11111111111111111111111111111111&#34;,
            &#34;data&#34;: [
                &#34;&#34;,
                &#34;&#34;
            ]
        },
        &#34;computeUnitsConsumed&#34;: 88031
    },
    &#34;version&#34;: 0
}
上面的Transaction 使用的是Base64的Encoding格式，不同编码格式的结构会有一些差异但是字段都差不多." />
  <meta name="author" content="beyondのblog" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://beyondblog.github.io/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="https://beyondblog.github.io/theme.png" />

  
  
  
  
  

  
  
  

  
  

  
  
  
  
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css"
  integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI"
  crossorigin="anonymous"
/>
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js"
  integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t"
  crossorigin="anonymous"
></script>
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js"
  integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
  crossorigin="anonymous"
></script>


<script>
  document.addEventListener('DOMContentLoaded', () =>
    renderMathInElement(document.body, {
      
      
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '$', right: '$', display: false },
      ],
      
      throwOnError: false,
    }),
  );
</script>

  
  
  

  
  <link
    rel="icon"
    href="https://beyondblog.github.io/favicon.ico"
  />
  <link
    rel="apple-touch-icon"
    href="https://beyondblog.github.io/apple-touch-icon.png"
  />

  
  <meta name="generator" content="Hugo 0.135.0">

  
  
  
  
  
  
  <meta itemprop="name" content="如何快速解析Solana链上DEX交易数据">
  <meta itemprop="description" content="本文总结一下链上数据的提取流程
在solana链上所有的交易都是一条条&#34;指令(instruction)“,与evm不一样的是一个transaction 可以有多条指令, 每条指令又可以有多条inner instruciton. 当然一个transaction有最大空间限制所以不是无限条具体可以看下这篇介绍https://solana.com/docs/core/transactions
Transaction 的实际结构 下面是任意获取的一笔Transaction，为了方便阅读我精简了一些内容，下面来介绍下具体每个字段的含意
{ &#34;slot&#34;: 313260647, &#34;blockTime&#34;: 1736582313, &#34;transaction&#34;: [ &#34;AaIhW6A2M8DD88WylJhRKc8Do6Ug6k3HuW&#43;oVZsTxnEqH7zSgBXfo80qShXG6U75zt/I2CMHhShtjmqwuGnATQKAAQAIC/IlPLKcGu5mLOINQ6rlWlO979iOhixnmws&#43;sTB/ISXRVe3ON2GuQVor9ZXyM0O/QUuYjkejwy1W/Y0wxcR76293841lAK6Ro/l9pk4BiUPA64m6P1H327XvzYkL5&#43;4JmgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwZGb&#43;UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAEedVb8jHAbu50xW7OaBUH/bGy3qP0jlECsc2iVrwTjwabiFf&#43;q4GE&#43;2h/Y0YYwDXaxDncGus7VZig8AAAAAABBt324ddloZPZy&#43;FGzut5rBy0he1fWzeROoz1hX7/AKmMlyWPTiSJ8bs9ECkUjg2DC1oTmdr/EIQEjnvY2&#43;n4WbQ/&#43;if11/ZKdMCbHylYed5LCas238ndUUsyGqezjOXo3cRwRFfjcsWHIlalRMXxolPZyNvJQQHI3W4oWrQe6b9wZhPkTTwzClMMENgiooX55CfbfRLYY7muj35FD6ca6wcEAAUCrKoBAAgGAAIABgMHAQEDAgACDAIAAAAA4fUFAAAAAAcBAgERCAYAAQAKAwcBAQUbBwACAQUKBQkFDwcLDgsNDAsLCwsLCwsLAgEAI&#43;UXy5d6460qAQAAAAdkAAEA4fUFAAAAAF4zmSQAAAAA&#43;gAABwMCAAABCQEqimLdZp9XJM4tjpUdejtF2&#43;JiEUVagWtFAa7RJzx9sAMFAwcCAgY=&#34;, &#34;base64&#34; ], &#34;meta&#34;: { &#34;err&#34;: null, &#34;fee&#34;: 5000, &#34;preBalances&#34;: [ 1000010000, 0, 0, 1, 1, 1141440, 788933756007, 934087680, 731913600, 0, 22502253405, 6124801, 2039280, 4906415516450, 14035088759, 1141440 ], &#34;postBalances&#34;: [ 897965720, 2039280, 0, 1, 1, 1141440, 788933756007, 934087680, 731913600, 0, 22502253405, 6124801, 2039280, 4906515516450, 14035088759, 1141440 ], &#34;innerInstructions&#34;: [ { &#34;index&#34;: 1, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 6 ], &#34;data&#34;: &#34;84eT&#34; }, { &#34;programIdIndex&#34;: 3, &#34;accounts&#34;: [ 0, 2 ], &#34;data&#34;: &#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2 ], &#34;data&#34;: &#34;P&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2, 6 ], &#34;data&#34;: &#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34; } ] }, { &#34;index&#34;: 4, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 10 ], &#34;data&#34;: &#34;84eT&#34; }, { &#34;programIdIndex&#34;: 3, &#34;accounts&#34;: [ 0, 1 ], &#34;data&#34;: &#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 1 ], &#34;data&#34;: &#34;P&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 1, 10 ], &#34;data&#34;: &#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34; } ] }, { &#34;index&#34;: 5, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 15, &#34;accounts&#34;: [ 7, 11, 14, 11, 13, 12, 11, 11, 11, 11, 11, 11, 11, 11, 2, 1, 0 ], &#34;data&#34;: &#34;5ucmhStLiAKrHueiRPZaPeX&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2, 13, 0 ], &#34;data&#34;: &#34;3Dc8EpW7Kr3R&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 12, 1, 14 ], &#34;data&#34;: &#34;3x1R8aoLjRFu&#34; }, { &#34;programIdIndex&#34;: 5, &#34;accounts&#34;: [ 9 ], &#34;data&#34;: &#34;QMqFu4fYGGeUEysFnenhAvR83g86EDDNxzUskfkWKYCBPWe1hqgD6jgKAXr6aYoEQaxoqYMTvWgPVk2AHWGHjdbNiNtoaPfZA4znu6cRUSWSeJGBkZunVEvoYenVXbq4Tge3nrNuuvC6G4k8pkFasDAwMz8bFBpKqfFBg3pHojUCfiw&#34; } ] } ], &#34;preTokenBalances&#34;: [ { &#34;accountIndex&#34;: 12, &#34;owner&#34;: &#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;, &#34;programId&#34;: &#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;, &#34;mint&#34;: &#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;, &#34;uiTokenAmount&#34;: { &#34;amount&#34;: &#34;30190180808651&#34;, &#34;decimals&#34;: 6, &#34;uiAmount&#34;: 30190180.808651, &#34;uiAmountString&#34;: &#34;30190180.808651&#34; } } ], &#34;postTokenBalances&#34;: [ { &#34;accountIndex&#34;: 1, &#34;owner&#34;: &#34;HJEbYPihoGZ6wjjD5E3NHLybrcgdLLBqSHX4ZyrbqVjW&#34;, &#34;programId&#34;: &#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;, &#34;mint&#34;: &#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;, &#34;uiTokenAmount&#34;: { &#34;amount&#34;: &#34;613769982&#34;, &#34;decimals&#34;: 6, &#34;uiAmount&#34;: 613.769982, &#34;uiAmountString&#34;: &#34;613.769982&#34; } } ], &#34;logMessages&#34;: [], &#34;status&#34;: { &#34;Ok&#34;: null }, &#34;rewards&#34;: [], &#34;loadedAddresses&#34;: { &#34;readonly&#34;: [ &#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;, &#34;675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8&#34; ], &#34;writable&#34;: [ &#34;3hsdbMFsiCh3YCsXoFjgx4TVpxECsUE9nRMgvaoyveQT&#34;, &#34;A67nie3cYJy58EB3uQvLGrUJaH5FVPdGmX2Wo7DLxJco&#34;, &#34;AcsiBWpfYJnDpg4MRUJTwCbueCRTNeLBV27v5doA9RDv&#34; ] }, &#34;returnData&#34;: { &#34;programId&#34;: &#34;11111111111111111111111111111111&#34;, &#34;data&#34;: [ &#34;&#34;, &#34;&#34; ] }, &#34;computeUnitsConsumed&#34;: 88031 }, &#34;version&#34;: 0 } 上面的Transaction 使用的是Base64的Encoding格式，不同编码格式的结构会有一些差异但是字段都差不多.">
  <meta itemprop="datePublished" content="2025-01-14T12:03:51+08:00">
  <meta itemprop="dateModified" content="2025-01-14T12:03:51+08:00">
  <meta itemprop="wordCount" content="978">
  
  <meta property="og:url" content="https://beyondblog.github.io/posts/solana_dex_parse_trade/">
  <meta property="og:site_name" content="beyondのblog">
  <meta property="og:title" content="如何快速解析Solana链上DEX交易数据">
  <meta property="og:description" content="本文总结一下链上数据的提取流程
在solana链上所有的交易都是一条条&#34;指令(instruction)“,与evm不一样的是一个transaction 可以有多条指令, 每条指令又可以有多条inner instruciton. 当然一个transaction有最大空间限制所以不是无限条具体可以看下这篇介绍https://solana.com/docs/core/transactions
Transaction 的实际结构 下面是任意获取的一笔Transaction，为了方便阅读我精简了一些内容，下面来介绍下具体每个字段的含意
{ &#34;slot&#34;: 313260647, &#34;blockTime&#34;: 1736582313, &#34;transaction&#34;: [ &#34;AaIhW6A2M8DD88WylJhRKc8Do6Ug6k3HuW&#43;oVZsTxnEqH7zSgBXfo80qShXG6U75zt/I2CMHhShtjmqwuGnATQKAAQAIC/IlPLKcGu5mLOINQ6rlWlO979iOhixnmws&#43;sTB/ISXRVe3ON2GuQVor9ZXyM0O/QUuYjkejwy1W/Y0wxcR76293841lAK6Ro/l9pk4BiUPA64m6P1H327XvzYkL5&#43;4JmgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwZGb&#43;UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAEedVb8jHAbu50xW7OaBUH/bGy3qP0jlECsc2iVrwTjwabiFf&#43;q4GE&#43;2h/Y0YYwDXaxDncGus7VZig8AAAAAABBt324ddloZPZy&#43;FGzut5rBy0he1fWzeROoz1hX7/AKmMlyWPTiSJ8bs9ECkUjg2DC1oTmdr/EIQEjnvY2&#43;n4WbQ/&#43;if11/ZKdMCbHylYed5LCas238ndUUsyGqezjOXo3cRwRFfjcsWHIlalRMXxolPZyNvJQQHI3W4oWrQe6b9wZhPkTTwzClMMENgiooX55CfbfRLYY7muj35FD6ca6wcEAAUCrKoBAAgGAAIABgMHAQEDAgACDAIAAAAA4fUFAAAAAAcBAgERCAYAAQAKAwcBAQUbBwACAQUKBQkFDwcLDgsNDAsLCwsLCwsLAgEAI&#43;UXy5d6460qAQAAAAdkAAEA4fUFAAAAAF4zmSQAAAAA&#43;gAABwMCAAABCQEqimLdZp9XJM4tjpUdejtF2&#43;JiEUVagWtFAa7RJzx9sAMFAwcCAgY=&#34;, &#34;base64&#34; ], &#34;meta&#34;: { &#34;err&#34;: null, &#34;fee&#34;: 5000, &#34;preBalances&#34;: [ 1000010000, 0, 0, 1, 1, 1141440, 788933756007, 934087680, 731913600, 0, 22502253405, 6124801, 2039280, 4906415516450, 14035088759, 1141440 ], &#34;postBalances&#34;: [ 897965720, 2039280, 0, 1, 1, 1141440, 788933756007, 934087680, 731913600, 0, 22502253405, 6124801, 2039280, 4906515516450, 14035088759, 1141440 ], &#34;innerInstructions&#34;: [ { &#34;index&#34;: 1, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 6 ], &#34;data&#34;: &#34;84eT&#34; }, { &#34;programIdIndex&#34;: 3, &#34;accounts&#34;: [ 0, 2 ], &#34;data&#34;: &#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2 ], &#34;data&#34;: &#34;P&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2, 6 ], &#34;data&#34;: &#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34; } ] }, { &#34;index&#34;: 4, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 10 ], &#34;data&#34;: &#34;84eT&#34; }, { &#34;programIdIndex&#34;: 3, &#34;accounts&#34;: [ 0, 1 ], &#34;data&#34;: &#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 1 ], &#34;data&#34;: &#34;P&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 1, 10 ], &#34;data&#34;: &#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34; } ] }, { &#34;index&#34;: 5, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 15, &#34;accounts&#34;: [ 7, 11, 14, 11, 13, 12, 11, 11, 11, 11, 11, 11, 11, 11, 2, 1, 0 ], &#34;data&#34;: &#34;5ucmhStLiAKrHueiRPZaPeX&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2, 13, 0 ], &#34;data&#34;: &#34;3Dc8EpW7Kr3R&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 12, 1, 14 ], &#34;data&#34;: &#34;3x1R8aoLjRFu&#34; }, { &#34;programIdIndex&#34;: 5, &#34;accounts&#34;: [ 9 ], &#34;data&#34;: &#34;QMqFu4fYGGeUEysFnenhAvR83g86EDDNxzUskfkWKYCBPWe1hqgD6jgKAXr6aYoEQaxoqYMTvWgPVk2AHWGHjdbNiNtoaPfZA4znu6cRUSWSeJGBkZunVEvoYenVXbq4Tge3nrNuuvC6G4k8pkFasDAwMz8bFBpKqfFBg3pHojUCfiw&#34; } ] } ], &#34;preTokenBalances&#34;: [ { &#34;accountIndex&#34;: 12, &#34;owner&#34;: &#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;, &#34;programId&#34;: &#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;, &#34;mint&#34;: &#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;, &#34;uiTokenAmount&#34;: { &#34;amount&#34;: &#34;30190180808651&#34;, &#34;decimals&#34;: 6, &#34;uiAmount&#34;: 30190180.808651, &#34;uiAmountString&#34;: &#34;30190180.808651&#34; } } ], &#34;postTokenBalances&#34;: [ { &#34;accountIndex&#34;: 1, &#34;owner&#34;: &#34;HJEbYPihoGZ6wjjD5E3NHLybrcgdLLBqSHX4ZyrbqVjW&#34;, &#34;programId&#34;: &#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;, &#34;mint&#34;: &#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;, &#34;uiTokenAmount&#34;: { &#34;amount&#34;: &#34;613769982&#34;, &#34;decimals&#34;: 6, &#34;uiAmount&#34;: 613.769982, &#34;uiAmountString&#34;: &#34;613.769982&#34; } } ], &#34;logMessages&#34;: [], &#34;status&#34;: { &#34;Ok&#34;: null }, &#34;rewards&#34;: [], &#34;loadedAddresses&#34;: { &#34;readonly&#34;: [ &#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;, &#34;675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8&#34; ], &#34;writable&#34;: [ &#34;3hsdbMFsiCh3YCsXoFjgx4TVpxECsUE9nRMgvaoyveQT&#34;, &#34;A67nie3cYJy58EB3uQvLGrUJaH5FVPdGmX2Wo7DLxJco&#34;, &#34;AcsiBWpfYJnDpg4MRUJTwCbueCRTNeLBV27v5doA9RDv&#34; ] }, &#34;returnData&#34;: { &#34;programId&#34;: &#34;11111111111111111111111111111111&#34;, &#34;data&#34;: [ &#34;&#34;, &#34;&#34; ] }, &#34;computeUnitsConsumed&#34;: 88031 }, &#34;version&#34;: 0 } 上面的Transaction 使用的是Base64的Encoding格式，不同编码格式的结构会有一些差异但是字段都差不多.">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-01-14T12:03:51+08:00">
    <meta property="article:modified_time" content="2025-01-14T12:03:51+08:00">

  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="如何快速解析Solana链上DEX交易数据">
  <meta name="twitter:description" content="本文总结一下链上数据的提取流程
在solana链上所有的交易都是一条条&#34;指令(instruction)“,与evm不一样的是一个transaction 可以有多条指令, 每条指令又可以有多条inner instruciton. 当然一个transaction有最大空间限制所以不是无限条具体可以看下这篇介绍https://solana.com/docs/core/transactions
Transaction 的实际结构 下面是任意获取的一笔Transaction，为了方便阅读我精简了一些内容，下面来介绍下具体每个字段的含意
{ &#34;slot&#34;: 313260647, &#34;blockTime&#34;: 1736582313, &#34;transaction&#34;: [ &#34;AaIhW6A2M8DD88WylJhRKc8Do6Ug6k3HuW&#43;oVZsTxnEqH7zSgBXfo80qShXG6U75zt/I2CMHhShtjmqwuGnATQKAAQAIC/IlPLKcGu5mLOINQ6rlWlO979iOhixnmws&#43;sTB/ISXRVe3ON2GuQVor9ZXyM0O/QUuYjkejwy1W/Y0wxcR76293841lAK6Ro/l9pk4BiUPA64m6P1H327XvzYkL5&#43;4JmgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwZGb&#43;UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAEedVb8jHAbu50xW7OaBUH/bGy3qP0jlECsc2iVrwTjwabiFf&#43;q4GE&#43;2h/Y0YYwDXaxDncGus7VZig8AAAAAABBt324ddloZPZy&#43;FGzut5rBy0he1fWzeROoz1hX7/AKmMlyWPTiSJ8bs9ECkUjg2DC1oTmdr/EIQEjnvY2&#43;n4WbQ/&#43;if11/ZKdMCbHylYed5LCas238ndUUsyGqezjOXo3cRwRFfjcsWHIlalRMXxolPZyNvJQQHI3W4oWrQe6b9wZhPkTTwzClMMENgiooX55CfbfRLYY7muj35FD6ca6wcEAAUCrKoBAAgGAAIABgMHAQEDAgACDAIAAAAA4fUFAAAAAAcBAgERCAYAAQAKAwcBAQUbBwACAQUKBQkFDwcLDgsNDAsLCwsLCwsLAgEAI&#43;UXy5d6460qAQAAAAdkAAEA4fUFAAAAAF4zmSQAAAAA&#43;gAABwMCAAABCQEqimLdZp9XJM4tjpUdejtF2&#43;JiEUVagWtFAa7RJzx9sAMFAwcCAgY=&#34;, &#34;base64&#34; ], &#34;meta&#34;: { &#34;err&#34;: null, &#34;fee&#34;: 5000, &#34;preBalances&#34;: [ 1000010000, 0, 0, 1, 1, 1141440, 788933756007, 934087680, 731913600, 0, 22502253405, 6124801, 2039280, 4906415516450, 14035088759, 1141440 ], &#34;postBalances&#34;: [ 897965720, 2039280, 0, 1, 1, 1141440, 788933756007, 934087680, 731913600, 0, 22502253405, 6124801, 2039280, 4906515516450, 14035088759, 1141440 ], &#34;innerInstructions&#34;: [ { &#34;index&#34;: 1, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 6 ], &#34;data&#34;: &#34;84eT&#34; }, { &#34;programIdIndex&#34;: 3, &#34;accounts&#34;: [ 0, 2 ], &#34;data&#34;: &#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2 ], &#34;data&#34;: &#34;P&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2, 6 ], &#34;data&#34;: &#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34; } ] }, { &#34;index&#34;: 4, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 10 ], &#34;data&#34;: &#34;84eT&#34; }, { &#34;programIdIndex&#34;: 3, &#34;accounts&#34;: [ 0, 1 ], &#34;data&#34;: &#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 1 ], &#34;data&#34;: &#34;P&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 1, 10 ], &#34;data&#34;: &#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34; } ] }, { &#34;index&#34;: 5, &#34;instructions&#34;: [ { &#34;programIdIndex&#34;: 15, &#34;accounts&#34;: [ 7, 11, 14, 11, 13, 12, 11, 11, 11, 11, 11, 11, 11, 11, 2, 1, 0 ], &#34;data&#34;: &#34;5ucmhStLiAKrHueiRPZaPeX&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 2, 13, 0 ], &#34;data&#34;: &#34;3Dc8EpW7Kr3R&#34; }, { &#34;programIdIndex&#34;: 7, &#34;accounts&#34;: [ 12, 1, 14 ], &#34;data&#34;: &#34;3x1R8aoLjRFu&#34; }, { &#34;programIdIndex&#34;: 5, &#34;accounts&#34;: [ 9 ], &#34;data&#34;: &#34;QMqFu4fYGGeUEysFnenhAvR83g86EDDNxzUskfkWKYCBPWe1hqgD6jgKAXr6aYoEQaxoqYMTvWgPVk2AHWGHjdbNiNtoaPfZA4znu6cRUSWSeJGBkZunVEvoYenVXbq4Tge3nrNuuvC6G4k8pkFasDAwMz8bFBpKqfFBg3pHojUCfiw&#34; } ] } ], &#34;preTokenBalances&#34;: [ { &#34;accountIndex&#34;: 12, &#34;owner&#34;: &#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;, &#34;programId&#34;: &#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;, &#34;mint&#34;: &#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;, &#34;uiTokenAmount&#34;: { &#34;amount&#34;: &#34;30190180808651&#34;, &#34;decimals&#34;: 6, &#34;uiAmount&#34;: 30190180.808651, &#34;uiAmountString&#34;: &#34;30190180.808651&#34; } } ], &#34;postTokenBalances&#34;: [ { &#34;accountIndex&#34;: 1, &#34;owner&#34;: &#34;HJEbYPihoGZ6wjjD5E3NHLybrcgdLLBqSHX4ZyrbqVjW&#34;, &#34;programId&#34;: &#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;, &#34;mint&#34;: &#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;, &#34;uiTokenAmount&#34;: { &#34;amount&#34;: &#34;613769982&#34;, &#34;decimals&#34;: 6, &#34;uiAmount&#34;: 613.769982, &#34;uiAmountString&#34;: &#34;613.769982&#34; } } ], &#34;logMessages&#34;: [], &#34;status&#34;: { &#34;Ok&#34;: null }, &#34;rewards&#34;: [], &#34;loadedAddresses&#34;: { &#34;readonly&#34;: [ &#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;, &#34;675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8&#34; ], &#34;writable&#34;: [ &#34;3hsdbMFsiCh3YCsXoFjgx4TVpxECsUE9nRMgvaoyveQT&#34;, &#34;A67nie3cYJy58EB3uQvLGrUJaH5FVPdGmX2Wo7DLxJco&#34;, &#34;AcsiBWpfYJnDpg4MRUJTwCbueCRTNeLBV27v5doA9RDv&#34; ] }, &#34;returnData&#34;: { &#34;programId&#34;: &#34;11111111111111111111111111111111&#34;, &#34;data&#34;: [ &#34;&#34;, &#34;&#34; ] }, &#34;computeUnitsConsumed&#34;: 88031 }, &#34;version&#34;: 0 } 上面的Transaction 使用的是Base64的Encoding格式，不同编码格式的结构会有一些差异但是字段都差不多.">

  
  

  
  <link rel="canonical" href="https://beyondblog.github.io/posts/solana_dex_parse_trade/" />
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-[--w] px-8 lg:justify-center">
  <div class="relative z-50 ltr:mr-auto rtl:ml-auto flex items-center">
    <a class="-translate-y-[1px] text-2xl font-medium" href="https://beyondblog.github.io/"
      >beyondのblog</a
    >
    <div
      class="btn-dark text-[0] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 ltr:-mr-8 rtl:-ml-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    
    <nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-10 rtl:space-x-reverse">
      
      <a
        class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal"
        href="/posts/"
        >Post</a
      >
      
      <a
        class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal"
        href="/about/"
        >About</a
      >
      
    </nav>
    

    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-[--w] px-8 pb-16 pt-14 dark:prose-invert"
    >
      

<article>
  <header class="mb-14">
    <h1 class="!my-0 pb-2.5">如何快速解析Solana链上DEX交易数据</h1>

    
    <div class="text-xs antialiased opacity-60">
      
      <time>Jan 14, 2025</time>
      
      
      
      
    </div>
    
  </header>

  <section><p>本文总结一下链上数据的提取流程</p>
<p>在solana链上所有的交易都是一条条&quot;指令(instruction)“,与evm不一样的是一个transaction 可以有多条指令, 每条指令又可以有多条inner instruciton. 当然一个transaction有最大空间限制所以不是无限条具体可以看下这篇介绍https://solana.com/docs/core/transactions</p>
<p><img src="https://solana-developer-content.vercel.app/assets/docs/core/transactions/sol-transfer.svg" alt="SOL Transfer"></p>
<h4 id="transaction-的实际结构">Transaction 的实际结构</h4>
<p>下面是任意获取的一笔Transaction，为了方便阅读我精简了一些内容，下面来介绍下具体每个字段的含意</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;slot&#34;</span>: <span style="color:#ae81ff">313260647</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;blockTime&#34;</span>: <span style="color:#ae81ff">1736582313</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;transaction&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;AaIhW6A2M8DD88WylJhRKc8Do6Ug6k3HuW+oVZsTxnEqH7zSgBXfo80qShXG6U75zt/I2CMHhShtjmqwuGnATQKAAQAIC/IlPLKcGu5mLOINQ6rlWlO979iOhixnmws+sTB/ISXRVe3ON2GuQVor9ZXyM0O/QUuYjkejwy1W/Y0wxcR76293841lAK6Ro/l9pk4BiUPA64m6P1H327XvzYkL5+4JmgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAEedVb8jHAbu50xW7OaBUH/bGy3qP0jlECsc2iVrwTjwabiFf+q4GE+2h/Y0YYwDXaxDncGus7VZig8AAAAAABBt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKmMlyWPTiSJ8bs9ECkUjg2DC1oTmdr/EIQEjnvY2+n4WbQ/+if11/ZKdMCbHylYed5LCas238ndUUsyGqezjOXo3cRwRFfjcsWHIlalRMXxolPZyNvJQQHI3W4oWrQe6b9wZhPkTTwzClMMENgiooX55CfbfRLYY7muj35FD6ca6wcEAAUCrKoBAAgGAAIABgMHAQEDAgACDAIAAAAA4fUFAAAAAAcBAgERCAYAAQAKAwcBAQUbBwACAQUKBQkFDwcLDgsNDAsLCwsLCwsLAgEAI+UXy5d6460qAQAAAAdkAAEA4fUFAAAAAF4zmSQAAAAA+gAABwMCAAABCQEqimLdZp9XJM4tjpUdejtF2+JiEUVagWtFAa7RJzx9sAMFAwcCAgY=&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;base64&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;meta&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;err&#34;</span>: <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;fee&#34;</span>: <span style="color:#ae81ff">5000</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;preBalances&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1000010000</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1141440</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">788933756007</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">934087680</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">731913600</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">22502253405</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">6124801</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">2039280</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">4906415516450</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">14035088759</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1141440</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;postBalances&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">897965720</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">2039280</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1141440</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">788933756007</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">934087680</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">731913600</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">22502253405</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">6124801</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">2039280</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">4906515516450</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">14035088759</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1141440</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;innerInstructions&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;instructions&#34;</span>: [
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;84eT&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;P&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                ]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;instructions&#34;</span>: [
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;84eT&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;11119os1e9qSs2u7TsThXqkBSRVFxhmYaFKFZ1waB2X7armDmvK3p5GmLdUxYdg3h7QSrL&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;P&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;6dRwGUbFW67pwDDpjAPEhmKQzMWGSk5TY9Cgv4ZYR8eAU&#34;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                ]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;instructions&#34;</span>: [
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">14</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">13</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">12</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;5ucmhStLiAKrHueiRPZaPeX&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">13</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;3Dc8EpW7Kr3R&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">12</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;3x1R8aoLjRFu&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;programIdIndex&#34;</span>: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;accounts&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;QMqFu4fYGGeUEysFnenhAvR83g86EDDNxzUskfkWKYCBPWe1hqgD6jgKAXr6aYoEQaxoqYMTvWgPVk2AHWGHjdbNiNtoaPfZA4znu6cRUSWSeJGBkZunVEvoYenVXbq4Tge3nrNuuvC6G4k8pkFasDAwMz8bFBpKqfFBg3pHojUCfiw&#34;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                ]
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;preTokenBalances&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;accountIndex&#34;</span>: <span style="color:#ae81ff">12</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;owner&#34;</span>: <span style="color:#e6db74">&#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;programId&#34;</span>: <span style="color:#e6db74">&#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;mint&#34;</span>: <span style="color:#e6db74">&#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;uiTokenAmount&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#e6db74">&#34;30190180808651&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;decimals&#34;</span>: <span style="color:#ae81ff">6</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;uiAmount&#34;</span>: <span style="color:#ae81ff">30190180.808651</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;uiAmountString&#34;</span>: <span style="color:#e6db74">&#34;30190180.808651&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;postTokenBalances&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;accountIndex&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;owner&#34;</span>: <span style="color:#e6db74">&#34;HJEbYPihoGZ6wjjD5E3NHLybrcgdLLBqSHX4ZyrbqVjW&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;programId&#34;</span>: <span style="color:#e6db74">&#34;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;mint&#34;</span>: <span style="color:#e6db74">&#34;FvgqHMfL9yn39V79huDPy3YUNDoYJpuLWng2JfmQpump&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;uiTokenAmount&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#e6db74">&#34;613769982&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;decimals&#34;</span>: <span style="color:#ae81ff">6</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;uiAmount&#34;</span>: <span style="color:#ae81ff">613.769982</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;uiAmountString&#34;</span>: <span style="color:#e6db74">&#34;613.769982&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;logMessages&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;status&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Ok&#34;</span>: <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rewards&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;loadedAddresses&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;readonly&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8&#34;</span>
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;writable&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;3hsdbMFsiCh3YCsXoFjgx4TVpxECsUE9nRMgvaoyveQT&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;A67nie3cYJy58EB3uQvLGrUJaH5FVPdGmX2Wo7DLxJco&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;AcsiBWpfYJnDpg4MRUJTwCbueCRTNeLBV27v5doA9RDv&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;returnData&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;programId&#34;</span>: <span style="color:#e6db74">&#34;11111111111111111111111111111111&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;data&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;computeUnitsConsumed&#34;</span>: <span style="color:#ae81ff">88031</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的Transaction 使用的是Base64的Encoding格式，不同编码格式的结构会有一些差异但是字段都差不多.</p>
<p>Transaction 主要有两个重要的字段meta 和 transaction,  meta 区域主要存放了本次交易涉及到的所有账户的余额变动情况(包括sol和spl token)、所有的inner instruction（注意是inner instruction不是instruction)、logs、还有地址表（loadedAddresses, 这个非常重要后面会介绍到）。transaction区域是一个编码的需要再一次parser才能得到, 里面主要是有 static account table（所有的账户索引），instruction（所有的指令）</p>
<h5 id="instruction-和-inner-instruction-的关系">Instruction 和 inner Instruction 的关系</h5>
<p>每一个program的调用都是以一条 instruction的形式调用, inner instruction相当于是这个program 指令的内部交易，例如业务逻辑是swap 代币,那么里面肯定会有spl transfer 的inner instruction。相当于evm里面Transaction的Internal Tx.</p>
<p>由于本文主要是介绍解析dex的交易数据, 主要是考虑dex相关逻辑的program。应该仅解析instruction吗？不由于链上会有很多交易聚合工具例如 jup, 它会代理真正的dex trade instruction 调用为了保证数据完整性数据需要从 inner instruction中也解析一遍.</p>
<h4 id="如何解析">如何解析</h4>
<p>简单的方案可以通过遍历solana 的slot，然后提取所有的transaction list 挨个去处理, 但是这样太慢了！</p>
<p>为了追求最快的行情提取,可以使用websocket来实时订阅每一个区块，通过”推“的方式来获取数据。当然这种方案也过时了,现在最流行的方案是使用Geyser Yellowstone插件的方式来获取</p>
<h5 id="什么是yellowstone">什么是Yellowstone？</h5>
<p>yellowstone 其实是一个solana 验证节点的插件,它通过grpc协议的方式从节点中把实时数据推给调用方。具体可以从这里了解更多 <a href="https://github.com/rpcpool/yellowstone-grpc">https://github.com/rpcpool/yellowstone-grpc</a></p>
<p>虽然它很快, 但是它非常昂贵. 目前要么通过自己部署专属节点来安装插件的形式去获得, 专属节点的价格不便宜, 以helius提供的服务为例子目前一个月要2000刀左右。另一种方法是使用第三方的共享yellowstone服务，目前了解到instantnodes和quicknode 都有提供, 这里推荐quicknode 只需要500刀/月 就能用上，但是每条数据的获取都要按条计费。所以如果是追求最佳性能专属节点是非常好的选择。</p>
<h5 id="yellowstone-如何用">yellowstone 如何用？</h5>
<p>插件的仓库有具体的例子, 后续本文会以golang 语言为主要开发语言举例. 首先来简单看下yellowstone的用法, 它提供一种filter 能力, 指定订阅某个账户的所有tx基于这个能力我们可以把一些dex program 都订阅上,这样只要有交易性能就一定能获得到tx事件，直接解析就行了。</p>
<p>yellowstone 的数据结构与 sol rpc 获取到的transaction结构有一些不同，可以通过查看<a href="https://github.com/rpcpool/yellowstone-grpc/blob/master/yellowstone-grpc-proto/proto/geyser.proto#L156">proto</a>看到具体的结构 例如</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">SubscribeUpdateTransactionInfo</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">bytes</span> signature <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">bool</span> is_vote <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  solana.storage.ConfirmedBlock.Transaction transaction <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  solana.storage.ConfirmedBlock.TransactionStatusMeta meta <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">uint64</span> index <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>可以看到除了没有时间字段,主要也是 transaction和meta两类数据</p>
<p>那么监听的流程就是, 建立一个grpc的connect, 然后创建一个transactions_sub结构,将需要解析的program account 填入 account_include 中, 例如pump.fun、raydium 等等. 这样当任意一笔交易与这些账户有交互时都会推送相关transaction过来</p>
<h5 id="解析-pumpfun">解析 Pump.fun</h5>
<p>接下来介绍下如何解析pump.fun中所有的买卖交易、池子发射、ca创建</p>
<p>首先需要找到pump.fun的program,通过solscan很容找到它. 我们需要分别找到每种类型的交易tx，便于我们分析具体如何解析</p>
<ul>
<li>
<p>代币创建</p>
<p><a href="https://solscan.io/tx/4F5kfYjMVuehVRQeehAKDTo3Jnd5PJX5q9SW2BycaMZSNW7N5QphzAQU2nQCZ7yvKbzeP1hHMRnAcyZ9GmCu7R1T?utm_source=https://sweepy.club">相关tx</a></p>
<p><img src="/img/pump_fun_create.png" alt="pump_fun_create"></p>
<p>由于solana的program机制是在执行交易的时候需要把本次涉及到的所有account 都传入到指令中，所以我们分析交易行为和提取数据会非常的方便。</p>
<p>从上面这张图可以获得一些关键信息</p>
<p>pump.fun的合约地址是6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P</p>
<p>CA的账户是J8DsvUjD4xzjGL3ccDGmnPMWMG96iEcTPNvrwL1kpump</p>
<p>CA 的部署者是DJtXr8VPm9FbSwrSnbg3Go4Wbnc29H4o7qPnnQLeZ729</p>
<p>我们还想获得到 代币的symbol、logo、twitter url、bonding Curve等信息，如何获取呢？往下继续找</p>
<p><img src="/img/pump_fun_create_event.png" alt="pump_fun_create_event"></p>
</li>
</ul>
<p>​	可以看到 pump.fun的合约内部有打印一个log,这个log里面有我们想要的所有数据,也就是说只要解析到这个 event log 就能拿到代币的所有信息了。那么如何解析这个log呢，代码的逻辑可以是这样</p>
<p>由于event log 必然是inner instruction中产生的, 所以仅需要遍历 meta中的指令行了. 那么代码可能是下面这样</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">parserPumpFun</span>(<span style="color:#a6e22e">subscribeUpdateTransaction</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">proto</span>.<span style="color:#a6e22e">SubscribeUpdate_Transaction</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">subscribeUpdateTransaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Meta</span>.<span style="color:#a6e22e">Err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">accountKey</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">subscribeUpdateTransaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Message</span>.<span style="color:#a6e22e">AccountKeys</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">meta</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">subscribeUpdateTransaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Meta</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">signature</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">base58</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">subscribeUpdateTransaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Signature</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slot</span> <span style="color:#f92672">:=</span> int64(<span style="color:#a6e22e">subscribeUpdateTransaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Slot</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">innerInstructions</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">subscribeUpdateTransaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Transaction</span>.<span style="color:#a6e22e">Meta</span>.<span style="color:#a6e22e">InnerInstructions</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 遍历yellowstone推送过来的所有 inner instruction
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">innerInstruction</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">innerInstructions</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">instruction</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">innerInstruction</span>.<span style="color:#a6e22e">Instructions</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 由于推送过来的program只有 account index, 所以需要解析下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">programAccount</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">meta</span>.<span style="color:#a6e22e">ProgramAddress</span>(<span style="color:#a6e22e">accountKey</span>, byte(<span style="color:#a6e22e">instruction</span>.<span style="color:#a6e22e">ProgramIdIndex</span>))
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 判断当前的inner instruction 是不是pumpfun的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">programAccount</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">consts</span>.<span style="color:#a6e22e">Pumpfun</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 尝试解析下log
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>				<span style="color:#a6e22e">instructionData</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">base58</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">instruction</span>.<span style="color:#a6e22e">Data</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">createEvent</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pumpfun</span>.<span style="color:#a6e22e">ParseCreateEventInstruction</span>(<span style="color:#a6e22e">instruction</span>.<span style="color:#a6e22e">Data</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">createEvent</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 提取想要的数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>					<span style="color:#a6e22e">newPool</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">helius</span>.<span style="color:#a6e22e">PumpNewPool</span>{
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">Name</span>:             <span style="color:#a6e22e">createEvent</span>.<span style="color:#a6e22e">Name</span>, <span style="color:#75715e">// mint代币 的名字
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>						<span style="color:#a6e22e">Symbol</span>:           <span style="color:#a6e22e">createEvent</span>.<span style="color:#a6e22e">Symbol</span>, <span style="color:#75715e">// mint 代币的symbol
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">Uri</span>:              <span style="color:#a6e22e">createEvent</span>.<span style="color:#a6e22e">Uri</span>, <span style="color:#75715e">// mint 代币的metadata uri （logo twitter相关的都在这里)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>						<span style="color:#a6e22e">Mint</span>:             <span style="color:#a6e22e">createEvent</span>.<span style="color:#a6e22e">Mint</span>.<span style="color:#a6e22e">String</span>(), <span style="color:#75715e">// mint 代币的地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>						<span style="color:#a6e22e">BondingCurve</span>:     <span style="color:#a6e22e">createEvent</span>.<span style="color:#a6e22e">BondingCurve</span>.<span style="color:#a6e22e">String</span>(), <span style="color:#75715e">// mint 代币的交易池子地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>						<span style="color:#a6e22e">User</span>:             <span style="color:#a6e22e">createEvent</span>.<span style="color:#a6e22e">User</span>.<span style="color:#a6e22e">String</span>(), <span style="color:#75715e">// mint 的dev 地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>						<span style="color:#a6e22e">TxHash</span>:           <span style="color:#a6e22e">signature</span>,
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">Slot</span>:             <span style="color:#a6e22e">slot</span>,
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">InstructionIndex</span>: <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%d_%d&#34;</span>, <span style="color:#a6e22e">innerInstruction</span>.<span style="color:#a6e22e">Index</span>, <span style="color:#a6e22e">j</span>),
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">Timestamp</span>:        <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>(),
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 进行落盘，可以存到kafka或者数仓
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>					<span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">pumpNewPoolHandler</span>(<span style="color:#a6e22e">newPool</span>)
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的代码注释写的很清楚了, 但是有几个关键技术需要在解释下</p>
<ol>
<li>
<p>如何获取到当前指令的执行program 的account address？</p>
<p>由于链上源数据的账户都是“索引”概念, 这里有一个非常坑的地方是需要根据loadedAddresses来解析数据，它的流程大概是下面这样</p>
<p>首先检查索引是否在 staticAccountKeys 范围内,如果在则直接根据staticAccountKeys去获取
否则通过减去 staticAccountKeys 的长度来调整索引
检查调整后的索引是否在 writableAddresses 范围内，如果在则直接在writableAddresses中获取
否则通过减去 writableAddresses 的长度来进一步调整索引
最后检查 readonlyAddresses，如果在则直接获取，否则就返回错误</p>
<p>相关的代码如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">x</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TransactionStatusMeta</span>) <span style="color:#a6e22e">ProgramAddress</span>(<span style="color:#a6e22e">staticAccountKeys</span> [][]<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">programIDIndex</span> <span style="color:#66d9ef">byte</span>) (<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">index</span> <span style="color:#f92672">:=</span> int(<span style="color:#a6e22e">programIDIndex</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">index</span> &lt; len(<span style="color:#a6e22e">staticAccountKeys</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKeyFromBytes</span>(<span style="color:#a6e22e">staticAccountKeys</span>[<span style="color:#a6e22e">programIDIndex</span>]).<span style="color:#a6e22e">String</span>(), <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 调整索引值，减去 staticAccountKeys 的长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">index</span> <span style="color:#f92672">-=</span> len(<span style="color:#a6e22e">staticAccountKeys</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 检查是否在 writableAddresses 范围内
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">index</span> &lt; len(<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">LoadedWritableAddresses</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKeyFromBytes</span>(<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">LoadedWritableAddresses</span>[<span style="color:#a6e22e">index</span>]).<span style="color:#a6e22e">String</span>(), <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 再次调整索引，减去 writableAddresses 的长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">index</span> <span style="color:#f92672">-=</span> len(<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">LoadedWritableAddresses</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 最后检查 readonlyAddresses
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">index</span> &lt; len(<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">LoadedReadonlyAddresses</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKeyFromBytes</span>(<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">LoadedReadonlyAddresses</span>[<span style="color:#a6e22e">index</span>]).<span style="color:#a6e22e">String</span>(), <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKey</span>{}.<span style="color:#a6e22e">String</span>(), <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;programID index not found %d&#34;</span>, <span style="color:#a6e22e">programIDIndex</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p>如何解析event log</p>
<p>非常简单, pump.fun使用的是anchor编写的合约, event 是用的Borsh编码的, 只需要用Borsh反编码就出来了。golang的解析代码如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 需要注意的是这个结构的每个字段的类型, 需要跟链上event匹配,否则会解析出错误的数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">CreateEvent</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>         <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Symbol</span>       <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Uri</span>          <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Mint</span>         <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKey</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">BondingCurve</span> <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKey</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">User</span>         <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKey</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">ParseCreateEventInstruction</span>(<span style="color:#a6e22e">decodedBytes</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">CreateEvent</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">decodedBytes</span>) &lt; <span style="color:#ae81ff">16</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;error decoding create instruction data: too short&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 跳过前面16个字节, 前16个字节是discriminator
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">decoder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ag_binary</span>.<span style="color:#a6e22e">NewBorshDecoder</span>(<span style="color:#a6e22e">decodedBytes</span>[<span style="color:#ae81ff">16</span>:])
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">create</span> <span style="color:#a6e22e">CreateEvent</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">create</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;error unmarshaling TradeEvent: %s&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">create</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
</ol>
<p>3.如何解析pump的所有交易</p>
<p>​	和解析创建代币一样的逻辑, 只需要找到对应Buy的指令特征就行，例如下面的这个</p>
<p><img src="/img/pump_fun_trade_event.png" alt="pump_fun_trade_event"></p>
<p>​	可以看到实际上pump.fun的program每次trade之后也会创建一个event，只需要解析出这个event logs就行</p>
<p>​	为了准确匹配出交易特征, 代码中可以根据instruction data 的前缀是否是指定的discriminator前缀就行, 代码如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TradeEvent</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Mint</span>                 <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKey</span> <span style="color:#75715e">// 代币ca
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">SolAmount</span>            <span style="color:#66d9ef">uint64</span> <span style="color:#75715e">// 交易的sol数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">TokenAmount</span>          <span style="color:#66d9ef">uint64</span> <span style="color:#75715e">// 交易的代币数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">IsBuy</span>                <span style="color:#66d9ef">bool</span> <span style="color:#75715e">// 交易side
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">User</span>                 <span style="color:#a6e22e">solana</span>.<span style="color:#a6e22e">PublicKey</span> <span style="color:#75715e">// 交易者
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Timestamp</span>            <span style="color:#66d9ef">int64</span> <span style="color:#75715e">// 交易时间戳
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">VirtualSolReserves</span>   <span style="color:#66d9ef">uint64</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">VirtualTokenReserves</span> <span style="color:#66d9ef">uint64</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">ParseTradeEventInstruction2</span>(<span style="color:#a6e22e">decodedBytes</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">TradeEvent</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">decoder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ag_binary</span>.<span style="color:#a6e22e">NewBorshDecoder</span>(<span style="color:#a6e22e">decodedBytes</span>[<span style="color:#ae81ff">16</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">decodedBytes</span>) &lt; <span style="color:#ae81ff">16</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;error decoding trade instruction data: too short&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">trade</span> <span style="color:#a6e22e">TradeEvent</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">trade</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;error unmarshaling TradeEvent: %s&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">trade</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>..
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 2K7nL28P 就是trade event的discriminator前缀
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasPrefix</span>(<span style="color:#a6e22e">instructionData</span>, <span style="color:#e6db74">&#34;2K7nL28P&#34;</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tradeEvent</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pumpfun</span>.<span style="color:#a6e22e">ParseTradeEventInstruction2</span>(<span style="color:#a6e22e">instruction</span>.<span style="color:#a6e22e">Data</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tradeEvent</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">txType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">enums</span>.<span style="color:#a6e22e">TxTypeBuy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">IsBuy</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">txType</span> = <span style="color:#a6e22e">enums</span>.<span style="color:#a6e22e">TxTypeSell</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 由于pumpfun的decimal都是固定的,所以直接除就好
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">token0Amount</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">decimal</span>.<span style="color:#a6e22e">NewFromUint64</span>(<span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">SolAmount</span>).<span style="color:#a6e22e">Div</span>(<span style="color:#a6e22e">decimal</span>.<span style="color:#a6e22e">NewFromInt</span>(<span style="color:#ae81ff">1_000_000_000</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">token1Amount</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">decimal</span>.<span style="color:#a6e22e">NewFromUint64</span>(<span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">TokenAmount</span>).<span style="color:#a6e22e">Div</span>(<span style="color:#a6e22e">decimal</span>.<span style="color:#a6e22e">NewFromInt</span>(<span style="color:#ae81ff">1_000_000</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">token0UnitPrice</span> <span style="color:#a6e22e">decimal</span>.<span style="color:#a6e22e">Decimal</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token1Amount</span>.<span style="color:#a6e22e">Cmp</span>(<span style="color:#a6e22e">decimal</span>.<span style="color:#a6e22e">Zero</span>) &gt; <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">token0UnitPrice</span> = <span style="color:#a6e22e">token0Amount</span>.<span style="color:#a6e22e">Div</span>(<span style="color:#a6e22e">token1Amount</span>).<span style="color:#a6e22e">Round</span>(<span style="color:#ae81ff">18</span>)
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">token0UnitPrice</span> = <span style="color:#a6e22e">decimal</span>.<span style="color:#a6e22e">Zero</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">trade</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">helius</span>.<span style="color:#a6e22e">PumpTrade</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">DexName</span>:              <span style="color:#e6db74">&#34;pump.fun&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">PoolAddress</span>:          <span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">Mint</span>.<span style="color:#a6e22e">String</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">TxHash</span>:               <span style="color:#a6e22e">signature</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">TxType</span>:               string(<span style="color:#a6e22e">txType</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Slot</span>:                 int64(<span style="color:#a6e22e">slot</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">InstructionIndex</span>:     <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%d_%d&#34;</span>, <span style="color:#a6e22e">innerInstruction</span>.<span style="color:#a6e22e">Index</span>, <span style="color:#a6e22e">j</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Timestamp</span>:            <span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">Timestamp</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">TraderAddress</span>:        <span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">User</span>.<span style="color:#a6e22e">String</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Token0Amount</span>:         <span style="color:#a6e22e">token0Amount</span>.<span style="color:#a6e22e">String</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Token1Amount</span>:         <span style="color:#a6e22e">token1Amount</span>.<span style="color:#a6e22e">String</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Token0UnitPrice</span>:      <span style="color:#a6e22e">token0UnitPrice</span>.<span style="color:#a6e22e">String</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Token0Address</span>:        <span style="color:#a6e22e">consts</span>.<span style="color:#a6e22e">WrappedSOLAddress</span>, <span style="color:#75715e">// pump 固定sol
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Token1Address</span>:        <span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">Mint</span>.<span style="color:#a6e22e">String</span>(), <span style="color:#75715e">// pump交易的代币
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">VirtualSolReserves</span>:   <span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">VirtualSolReserves</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">VirtualTokenReserves</span>: <span style="color:#a6e22e">tradeEvent</span>.<span style="color:#a6e22e">VirtualTokenReserves</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tradeResult</span> = append(<span style="color:#a6e22e">tradeResult</span>, <span style="color:#a6e22e">trade</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>以上就是如何通过yellowstone订阅指定program transaction, 然后解析pump.fun 的相关数据的逻辑, 至于如何解析发射池子, 后续会在解析raydium 相关数据中介绍</p>
</section>

  
  

  
  
  
  
  <nav
    class="mt-24 flex overflow-hidden rounded-xl bg-black/[3%] text-lg !leading-[1.2] *:flex *:w-1/2 *:items-center *:p-5 *:font-medium *:no-underline dark:bg-white/[8%] [&>*:hover]:bg-black/[2%] dark:[&>*:hover]:bg-white/[3%]"
  >
    
    
    <a class="ltr:ml-auto rtl:mr-auto justify-end pl-3" href="https://beyondblog.github.io/posts/ton_ctf_2024/"
      ><span>TON CTF 2024 Writeup</span><span class="ltr:ml-1.5 rtl:mr-1.5">→</span></a
    >
    
  </nav>
  
  

  
  

  
  

  


  
</article>


    </main>

    <footer
  class="mx-auto flex h-[4.5rem] max-w-[--w] items-center px-8 text-xs uppercase tracking-wider opacity-60"
>
  <div class="mr-auto">
  
    &copy; 2025
    <a class="link" href="https://beyondblog.github.io/">beyondのblog</a>
  
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >powered by hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >hugo-paper</a
  >
</footer>

  </body>
</html>
